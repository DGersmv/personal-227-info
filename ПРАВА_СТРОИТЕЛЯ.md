# üèóÔ∏è –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –°—Ç—Ä–æ–∏—Ç–µ–ª—è - –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è

## ‚úÖ –ß—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –°—Ç—Ä–æ–∏—Ç–µ–ª—å

### **1. –†–∞–±–æ—Ç–∞ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏**

–°—Ç—Ä–æ–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏:

- ‚úÖ **–ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä–µ–∫—Ç–æ–≤:**
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
  - –í–∏–¥–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

- ‚úÖ **–ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤:**
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –Ω–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–∞—Ö
  - –í–∏–¥–µ—Ç—å —ç—Ç–∞–ø—ã –ø—Ä–æ–µ–∫—Ç–æ–≤
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —á–µ—Ä—Ç–µ–∂–∏ –∏ –ø–ª–∞–Ω—ã
  - –°–∫–∞—á–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### **2. –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞**

–°—Ç—Ä–æ–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ –∏ –ø–∞–Ω–æ—Ä–∞–º—ã:

- ‚úÖ **–§–æ—Ç–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞:**
  - –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
  - –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç
  - –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–µ—Å—Ç
  - –û—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ñ–æ—Ç–æ –≤ –ø–∞–ø–∫–∏
  - –£–¥–∞–ª—è—Ç—å —Å–≤–æ–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ

- ‚úÖ **–ü–∞–Ω–æ—Ä–∞–º—ã 360¬∞:**
  - –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø–∞–Ω–æ—Ä–∞–º—ã –æ–±—ä–µ–∫—Ç–æ–≤
  - –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø–∞–Ω–æ—Ä–∞–º—ã –ø–æ–º–µ—â–µ–Ω–∏–π
  - –£–ø—Ä–∞–≤–ª—è—Ç—å –ø–∞–Ω–æ—Ä–∞–º–∞–º–∏
  - –£–¥–∞–ª—è—Ç—å —Å–≤–æ–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø–∞–Ω–æ—Ä–∞–º—ã

- ‚úÖ **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –º–µ–¥–∏–∞:**
  - –°–æ–∑–¥–∞–≤–∞—Ç—å –ø–∞–ø–∫–∏ –¥–ª—è —Ñ–æ—Ç–æ
  - –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ –ø–æ –ø–∞–ø–∫–∞–º
  - –£–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å—é —Ñ–æ—Ç–æ –¥–ª—è –ó–∞–∫–∞–∑—á–∏–∫–∞
  - –î–æ–±–∞–≤–ª—è—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è –∫ —Ñ–æ—Ç–æ

### **3. –û—Ç–º–µ—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç**

–°—Ç—Ä–æ–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–º–µ—á–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å:

- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤:**
  - –û—Ç–º–µ—á–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
  - –û–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã —Ä–∞–±–æ—Ç
  - –î–æ–±–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —ç—Ç–∞–ø–∞–º
  - –ü—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å —Ñ–æ—Ç–æ –∫ —ç—Ç–∞–ø–∞–º

- ‚úÖ **–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å:**
  - –°–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç—á–µ—Ç—ã –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞—Ö
  - –ü—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å —Ñ–æ—Ç–æ –∫ –æ—Ç—á–µ—Ç–∞–º
  - –£–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç

### **4. –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è**

- ‚úÖ **–°–æ–æ–±—â–µ–Ω–∏—è:**
  - –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ó–∞–∫–∞–∑—á–∏–∫—É
  - –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫—É
  - –ü–æ–ª—É—á–∞—Ç—å –∏ —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
  - –ü—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å —Ñ–∞–π–ª—ã –∫ —Å–æ–æ–±—â–µ–Ω–∏—è–º

- ‚úÖ **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:**
  - –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ –æ–±—ä–µ–∫—Ç–æ–≤
  - –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–Ω–æ—Ä–∞–º—ã (—Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏)
  - –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
  - –û—Ç–º–µ—á–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ

### **5. –ü–ª–∞–≥–∏–Ω—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**

- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

## ‚ùå –ß—Ç–æ –ù–ï –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –°—Ç—Ä–æ–∏—Ç–µ–ª—å

- ‚ùå –°–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã
- ‚ùå –£–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- ‚ùå –ò–∑–º–µ–Ω—è—Ç—å –ø—Ä–æ–µ–∫—Ç–Ω—ã–µ —á–µ—Ä—Ç–µ–∂–∏
- ‚ùå –£–¥–∞–ª—è—Ç—å –ø—Ä–æ–µ–∫—Ç—ã
- ‚ùå –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –æ–ø–ª–∞—Ç—ã
- ‚ùå –ò–∑–º–µ–Ω—è—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- ‚ùå –£–¥–∞–ª—è—Ç—å –æ–±—ä–µ–∫—Ç—ã
- ‚ùå –£–ø—Ä–∞–≤–ª—è—Ç—å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚ùå –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (—ç—Ç–æ –¥–µ–ª–∞–µ—Ç –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

### **–í API Routes –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:**

1. **–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ/–ø–∞–Ω–æ—Ä–∞–º—ã:**
   ```typescript
   // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
   if (!canUser(user, 'photo', 'create')) {
     return Response.json({ error: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤' }, { status: 403 });
   }
   
   // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –æ–±—ä–µ–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω –°—Ç—Ä–æ–∏—Ç–µ–ª—é
   const object = await prisma.object.findFirst({
     where: { 
       id: objectId,
       assignments: { some: { userId: user.id, role: 'BUILDER' } }
     }
   });
   
   if (!object) {
     return Response.json({ error: '–û–±—ä–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω' }, { status: 404 });
   }
   ```

2. **–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–æ—Ç–æ:**
   ```typescript
   // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–º
   const photo = await prisma.photo.findFirst({
     where: { 
       id: photoId,
       uploadedByUserId: user.id 
     }
   });
   
   if (!photo) {
     return Response.json({ error: '–§–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∏–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤' }, { status: 403 });
   }
   ```

3. **–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —ç—Ç–∞–ø–∞:**
   ```typescript
   // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —ç—Ç–∞–ø –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø—Ä–æ–µ–∫—Ç—É –Ω–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–º –æ–±—ä–µ–∫—Ç–µ
   const stage = await prisma.projectStage.findFirst({
     where: { id: stageId },
     include: {
       project: {
         include: {
           object: {
             include: {
               assignments: true
             }
           }
         }
       }
     }
   });
   
   const hasAccess = stage?.project.object.assignments.some(
     a => a.userId === user.id && a.role === 'BUILDER'
   );
   
   if (!hasAccess) {
     return Response.json({ error: '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–∞–ø—É' }, { status: 403 });
   }
   ```

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### **1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤:**

```typescript
// –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã –¥–ª—è –°—Ç—Ä–æ–∏—Ç–µ–ª—è
const objects = await prisma.object.findMany({
  where: {
    assignments: { 
      some: { 
        userId: user.id, 
        role: 'BUILDER' 
      } 
    }
  },
  include: {
    projects: true,
    photos: true,
    panoramas: true
  }
});
```

### **2. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ñ–æ—Ç–æ:**

–°—Ç—Ä–æ–∏—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å:
- –°–æ–∑–¥–∞–≤–∞—Ç—å –ø–∞–ø–∫–∏ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ç–æ
- –ü–µ—Ä–µ–º–µ—â–∞—Ç—å —Ñ–æ—Ç–æ –º–µ–∂–¥—É –ø–∞–ø–∫–∞–º–∏
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ –ø–æ —ç—Ç–∞–ø–∞–º —Ä–∞–±–æ—Ç
- –î–æ–±–∞–≤–ª—è—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫ —Ñ–æ—Ç–æ

### **3. –ü–∞–Ω–æ—Ä–∞–º—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏:**

–ü—Ä–∏ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–∞–Ω–æ—Ä–∞–º—ã –°—Ç—Ä–æ–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç:
- –£–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (yaw, pitch) –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- –î–æ–±–∞–≤–ª—è—Ç—å —Ñ–æ—Ç–æ –∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º
- –°–æ–∑–¥–∞–≤–∞—Ç—å –º–∞—Ä–∫–µ—Ä—ã –Ω–∞ –ø–∞–Ω–æ—Ä–∞–º–µ

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–µ –ø—Ä–∞–≤–∞ –°—Ç—Ä–æ–∏—Ç–µ–ª—è

| –†–µ—Å—É—Ä—Å | –°–æ–∑–¥–∞—Ç—å | –ß–∏—Ç–∞—Ç—å | –û–±–Ω–æ–≤–∏—Ç—å | –£–¥–∞–ª–∏—Ç—å |
|--------|---------|--------|----------|---------|
| –ü—Ä–æ–µ–∫—Ç—ã | ‚ùå | ‚úÖ | ‚ùå | ‚ùå |
| –û–±—ä–µ–∫—Ç—ã | ‚ùå | ‚úÖ (–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ) | ‚ùå | ‚ùå |
| –î–æ–∫—É–º–µ–Ω—Ç—ã | ‚ùå | ‚úÖ | ‚ùå | ‚ùå |
| –§–æ—Ç–æ | ‚úÖ | ‚úÖ | ‚úÖ (—Å–≤–æ–∏) | ‚úÖ (—Å–≤–æ–∏) |
| –ü–∞–Ω–æ—Ä–∞–º—ã | ‚úÖ | ‚úÖ | ‚úÖ (—Å–≤–æ–∏) | ‚úÖ (—Å–≤–æ–∏) |
| –ü–∞–ø–∫–∏ —Ñ–æ—Ç–æ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –°–æ–æ–±—â–µ–Ω–∏—è | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –≠—Ç–∞–ø—ã –ø—Ä–æ–µ–∫—Ç–∞ | ‚ùå | ‚úÖ | ‚úÖ (—Å—Ç–∞—Ç—É—Å—ã) | ‚ùå |

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-27



