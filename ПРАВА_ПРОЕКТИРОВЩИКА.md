# üìê –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫–∞ - –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è

## ‚úÖ –ß—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫

### **1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏**

–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–µ–∫—Ç–∞–º–∏:

- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤:**
  - –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤
  - –ù–∞–∑–Ω–∞—á–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –æ–±—ä–µ–∫—Ç–∞–º
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã –ø—Ä–æ–µ–∫—Ç–æ–≤ (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤ —Ä–∞–±–æ—Ç–µ, –∑–∞–≤–µ—Ä—à–µ–Ω, –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

- ‚úÖ **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤:**
  - –ò–∑–º–µ–Ω—è—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
  - –£–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç–∞–ø–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞
  - –ò–∑–º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ —ç—Ç–∞–ø–æ–≤
  - –û–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã —ç—Ç–∞–ø–æ–≤

- ‚úÖ **–ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤:**
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –Ω–∞ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–∞—Ö (–≥–¥–µ –Ω–∞–∑–Ω–∞—á–µ–Ω)
  - –í–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞

### **2. –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**

–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π:

- ‚úÖ **–¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:**
  - –ß–µ—Ä—Ç–µ–∂–∏ –∏ –ø–ª–∞–Ω—ã
  - –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è
  - –°–º–µ—Ç—ã –∏ —Ä–∞—Å—á–µ—Ç—ã
  - –†–∞–∑—Ä–µ—à–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
  - –î—Ä—É–≥–∏–µ –ø—Ä–æ–µ–∫—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- ‚úÖ **–î–µ–π—Å—Ç–≤–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏:**
  - –ó–∞–≥—Ä—É–∂–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –∫ –ø—Ä–æ–µ–∫—Ç–∞–º
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - –£–¥–∞–ª—è—Ç—å —Å–≤–æ–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
  - –û—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ —ç—Ç–∞–ø–∞–º –ø—Ä–æ–µ–∫—Ç–∞

- ‚úÖ **–î–æ—Å—Ç—É–ø –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º:**
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–æ–≤
  - –°–∫–∞—á–∏–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
  - –£–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å—é –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ó–∞–∫–∞–∑—á–∏–∫–∞

### **3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞–º–∏**

–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ–±—ä–µ–∫—Ç–∞–º–∏:

- ‚úÖ **–ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä–µ–∫—Ç–æ–≤:**
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã (—Å–≤–æ–∏ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ)
  - –í–∏–¥–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ñ–æ—Ç–æ –∏ –ø–∞–Ω–æ—Ä–∞–º—ã –æ–±—ä–µ–∫—Ç–æ–≤

- ‚úÖ **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤:**
  - –û–±–Ω–æ–≤–ª—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—ä–µ–∫—Ç–µ
  - –ò–∑–º–µ–Ω—è—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
  - –û–±–Ω–æ–≤–ª—è—Ç—å –∞–¥—Ä–µ—Å –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã
  - –£–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å–æ–º –æ–±—ä–µ–∫—Ç–∞

- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤:**
  - –°–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –¥–ª—è —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
  - –ù–∞–∑–Ω–∞—á–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –ó–∞–∫–∞–∑—á–∏–∫–∞–º

### **4. –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è**

- ‚úÖ **–°–æ–æ–±—â–µ–Ω–∏—è:**
  - –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ó–∞–∫–∞–∑—á–∏–∫—É
  - –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –°—Ç—Ä–æ–∏—Ç–µ–ª—é
  - –ü–æ–ª—É—á–∞—Ç—å –∏ —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
  - –ü—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å —Ñ–∞–π–ª—ã –∫ —Å–æ–æ–±—â–µ–Ω–∏—è–º

- ‚úÖ **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:**
  - –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ –æ–±—ä–µ–∫—Ç–æ–≤
  - –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–Ω–æ—Ä–∞–º—ã
  - –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
  - –û—Ç–º–µ—á–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ

### **5. –ü–ª–∞–≥–∏–Ω—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**

- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

## ‚ùå –ß—Ç–æ –ù–ï –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫

- ‚ùå –£–¥–∞–ª—è—Ç—å –æ–±—ä–µ–∫—Ç—ã –ó–∞–∫–∞–∑—á–∏–∫–∞ (—Ç–æ–ª—å–∫–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)
- ‚ùå –£–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–∞–±–æ—Ç–∞–º–∏
- ‚ùå –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –æ–ø–ª–∞—Ç—ã
- ‚ùå –ò–∑–º–µ–Ω—è—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- ‚ùå –£–¥–∞–ª—è—Ç—å —Ñ–æ—Ç–æ –∏ –ø–∞–Ω–æ—Ä–∞–º—ã, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–º
- ‚ùå –£–ø—Ä–∞–≤–ª—è—Ç—å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚ùå –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø–∞–Ω–æ—Ä–∞–º—ã (—ç—Ç–æ –¥–µ–ª–∞–µ—Ç –°—Ç—Ä–æ–∏—Ç–µ–ª—å)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

### **–í API Routes –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:**

1. **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞:**
   ```typescript
   // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
   if (!canUser(user, 'project', 'create')) {
     return Response.json({ error: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤' }, { status: 403 });
   }
   
   // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –æ–±—ä–µ–∫—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
   const object = await prisma.object.findFirst({
     where: { id: objectId }
   });
   ```

2. **–ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞:**
   ```typescript
   // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
   if (!canUser(user, 'object', 'update')) {
     return Response.json({ error: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤' }, { status: 403 });
   }
   
   // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –æ–±—ä–µ–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫—É –∏–ª–∏ –æ–Ω –µ–≥–æ —Å–æ–∑–¥–∞–ª
   const object = await prisma.object.findFirst({
     where: { 
       id: objectId,
       OR: [
         { userId: user.id }, // –°–æ–∑–¥–∞–Ω –∏–º
         { assignments: { some: { userId: user.id, role: 'DESIGNER' } } } // –ù–∞–∑–Ω–∞—á–µ–Ω –µ–º—É
       ]
     }
   });
   ```

3. **–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
   ```typescript
   // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫–æ–º
   const document = await prisma.document.findFirst({
     where: { 
       id: documentId,
       uploadedByUserId: user.id 
     }
   });
   ```

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### **1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤:**

–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫ –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å:
- –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã, –≥–¥–µ –æ–Ω –Ω–∞–∑–Ω–∞—á–µ–Ω
- –ü—Ä–æ–µ–∫—Ç—ã –Ω–∞ –æ–±—ä–µ–∫—Ç–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω —Å–æ–∑–¥–∞–ª
- –ü—Ä–æ–µ–∫—Ç—ã –Ω–∞ –æ–±—ä–µ–∫—Ç–∞—Ö, –≥–¥–µ –æ–Ω –Ω–∞–∑–Ω–∞—á–µ–Ω —á–µ—Ä–µ–∑ `UserObjectAssignment`

### **2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤:**

```typescript
// –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã –¥–ª—è –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫–∞
const objects = await prisma.object.findMany({
  where: {
    OR: [
      { userId: user.id }, // –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–º
      { assignments: { some: { userId: user.id, role: 'DESIGNER' } } } // –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –µ–º—É
    ]
  },
  include: {
    projects: true,
    assignments: true
  }
});
```

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–µ –ø—Ä–∞–≤–∞ –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫–∞

| –†–µ—Å—É—Ä—Å | –°–æ–∑–¥–∞—Ç—å | –ß–∏—Ç–∞—Ç—å | –û–±–Ω–æ–≤–∏—Ç—å | –£–¥–∞–ª–∏—Ç—å |
|--------|---------|--------|----------|---------|
| –ü—Ä–æ–µ–∫—Ç—ã | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –û–±—ä–µ–∫—Ç—ã | ‚úÖ (–¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤) | ‚úÖ | ‚úÖ | ‚ùå |
| –î–æ–∫—É–º–µ–Ω—Ç—ã | ‚úÖ (–ø—Ä–æ–µ–∫—Ç–Ω—ã–µ) | ‚úÖ | ‚úÖ (—Å–≤–æ–∏) | ‚úÖ (—Å–≤–æ–∏) |
| –§–æ—Ç–æ | ‚ùå | ‚úÖ | ‚ùå | ‚ùå |
| –ü–∞–Ω–æ—Ä–∞–º—ã | ‚ùå | ‚úÖ | ‚ùå | ‚ùå |
| –°–æ–æ–±—â–µ–Ω–∏—è | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –≠—Ç–∞–ø—ã –ø—Ä–æ–µ–∫—Ç–∞ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-27



